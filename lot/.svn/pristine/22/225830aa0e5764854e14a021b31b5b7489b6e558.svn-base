
<style>#search-form label{margin-right:10px}</style>
<div class="page-header col-xs-12">
    <form id="search-form">
        <{if $this->context->action->id == 'line' || (isset($smarty.get.tab) && $smarty.get.tab eq 'line')}>
        <!-- <label> 线路:
            <select type="select" name="line_id" id="line_id">
                <option value="">全部</option>
                <{foreach from=$data.show.lines item=v key=k}>
                <option value="<{$v['line_id']}>"<{if isset($smarty.get.line_id) && $smarty.get.line_id eq <{$v['line_id']}>}>selected<{/if}>><{$v['line_id']}></option>
                <{/foreach}>
            </select>
        </label> -->
        <label> 彩票种类:
            <select type="select" name="fc_type" id="fc_type">
                <option value="">全部</option>
                <{foreach from=$data.show.games item=v key=k}>
                <option value="<{$v['type']}>"<{if isset($smarty.get.fc_type) && $smarty.get.fc_type eq <{$v['type']}>}>selected<{/if}>><{$v['name']}></option>
                <{/foreach}>
            </select>
        </label>
        <{else}>
        <!-- <label> 代理帐号:
            <input type="text" placeholder="请输入代理账号" name="agentname" id="agentname" value="<{if isset($smarty.get.agentname)}><{$smarty.get.agentname}><{/if}>">
        </label> -->
        <label> 会员帐号:
            <input type="text" placeholder="请输入会员账号" name="username" id="username" value="<{if isset($smarty.get.username)}><{$smarty.get.username}><{/if}>">
        </label>
        <{/if}>
        <label for=""> 日期:
            <input class="laydate-icon" type="text" placeholder="请输入日期" name="starttime" id="starttime" value="<{if isset($smarty.get.starttime) }><{$smarty.get.starttime}><{/if}>">
            ~
            <input class="laydate-icon" type="text" placeholder="请输入日期" name="endtime" id="endtime" value="<{if isset($smarty.get.endtime) }><{$smarty.get.endtime}><{/if}>">
        </label>
        <br>
        <{if !($this->context->action->id == 'line' || (isset($smarty.get.tab) && $smarty.get.tab eq 'line'))}>
        <label> 彩票种类:
            <select type="select" name="fc_type" id="fc_type">
                <option value="">全部</option>
                <{foreach from=$data.show.games item=v key=k}>
                <option value="<{$v['type']}>"<{if isset($smarty.get.fc_type) && $smarty.get.fc_type eq <{$v['type']}>}>selected<{/if}>><{$v['name']}></option>
                <{/foreach}>
            </select>
        </label>
        <{/if}>
        <label> 排序:
            <select type="select" name="order_sort" id="order_sort">
                <option value="">请选择</option>
                <option value="bet-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'bet-asc'}> selected <{/if}> >总注单-升序</option>
                <option value="bet-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'bet-desc'}> selected <{/if}> >总注单-降序</option>
                <option value="bet_count-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'bet_count-asc'}> selected <{/if}> >总笔数-升序</option>
                <option value="bet_count-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'bet_count-desc'}> selected <{/if}> >总笔数-降序</option>
                <option value="valid_bet-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'valid_bet-asc' }> selected <{/if}> >有效注单-升序</option>
                <option value="valid_bet-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'valid_bet-desc' }> selected <{/if}> >有效注单-降序</option>
                <option value="valid_bet_count-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'valid_bet_count-asc' }> selected <{/if}> >有效笔数-升序</option>
                <option value="valid_bet_count-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'valid_bet_count-desc' }> selected <{/if}> >有效笔数-降序</option>
                <option value="win-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'win-asc' }> selected <{/if}> >盈利-升序</option>
                <option value="win-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'win-desc' }> selected <{/if}> >盈利-降序</option>
                <option value="win_count-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'win_count-asc' }> selected <{/if}> >赢笔数-升序</option>
                <option value="win_count-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'win_count-desc' }> selected <{/if}> >赢笔数-降序</option>
                <option value="addday-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'addday-asc' }> selected <{/if}> >日期-升序</option>
                <option value="addday-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'addday-desc' }> selected <{/if}> >日期-降序</option>
                <option value="updatetime-asc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'updatetime-asc' }> selected <{/if}> >时间-升序</option>
                <option value="updatetime-desc" <{if isset($smarty.get.order_sort) && $smarty.get.order_sort eq 'updatetime-desc' }> selected <{/if}> >时间-降序</option>
            </select>
        </label>
        <label> 每页显示条数:
            <select type="select" name="pagenum" id="pagenum">
                <option value="100" <{if isset($smarty.get.pagenum) && $smarty.get.pagenum eq 100}>selected<{/if}>>100</option>
                <option value="500" <{if isset($smarty.get.pagenum) && $smarty.get.pagenum eq 500}>selected<{/if}>>500</option>
                <option value="1000" <{if isset($smarty.get.pagenum) && $smarty.get.pagenum eq 1000}>selected<{/if}>>1000</option>
            </select>
        </label>
        <label> 页码:
            <select type="select" name="page" id="page">
                <{section name=loop loop=$result.pagecount}>
                <option value="<{$smarty.section.loop.index+1}>"
                    <{if isset($smarty.get.page) && $smarty.get.page eq $smarty.section.loop.index+1}>selected<{/if}>>
                    <{$smarty.section.loop.index+1}>
                </option>
                <{/section}>
            </select>
             共<{$result.pagecount}>页
        </label>
        <label>
            <input type="button" class="btn btn-sm btn-success" id="search" value="搜索"/>
        </label>
        <label><span class="btn btn-sm btn-success" id="export">导出到Excel</span></label>
    </form>
</div>

<!-- 本次的搜索项 用于导出excel -->
<form id="export-form">
  <{foreach from=$result.export_query key=k item=v}>
    <input type="hidden" name="<{$k}>" value="<{$v}>">
  <{/foreach}>
    <!-- <input type="hidden" name="list" value='<{ $result.data|json_encode}>'> -->
</form>

<div class="row">
    <div class="col-xs-12">
        <div class="table-responsive">
            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <{include file="_list.html"}>
            </table>
        </div>
    </div>
</div>
<div class="hr hr-18 dotted hr-double"></div>

<script>
    //pjax局部加载列表
    function search() {
        $.pjax({
            data: $('#search-form').serialize(),
            method: 'get',
            url: '?',
            container: '#container'
        });
    }
    // 搜索
    $('#search').click(function () {
        search();
    });
    // 彩种,排序,显示数,翻页
    $('#fc_type,#order_sort,#pagenum,#page').change(function () {
        search();
    });
    // 导出
    $('#export').click(function () {
        var query = $('#export-form').serialize();
        if(!query){
            layer.msg('请先搜索');
            return;
        }
        <{if isset($result['data']) && count($result['data']) == 0}>
            layer.msg('数据为空');
            return;
        <{/if}>
        layer.confirm('确定导出吗？', {
            btn: ['确定','取消']
        }, function(){
            layer.closeAll('dialog');
            location.href = 'export?' + $('#export-form').serialize();
        });
    });

    //时间控件
    var starttime = {
        elem: '#starttime',
        format: 'YYYY-MM-DD',
        max: laydate.now(),
        istime: false,
        istoday: true,
        choose: function (datas) {
            endtime.min = datas;
        }
    };
    laydate(starttime);
    var endtime = {
        elem: '#endtime',
        format: 'YYYY-MM-DD',
        max: laydate.now(),
        istime: false,
        istoday: true
    };
    laydate(endtime);

    <{if !isset($smarty.get.starttime)}>
        $('#starttime').val(laydate.now(0, 'YYYY-MM-DD'));
    <{/if}>
    <{if !isset($smarty.get.endtime)}>
        $('#endtime').val(laydate.now(0, 'YYYY-MM-DD'));
    <{/if}>
</script>
